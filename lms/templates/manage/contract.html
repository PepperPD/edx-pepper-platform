<%! from django.utils.translation import ugettext as _ %>

<%namespace name='static' file='../static_content.html'/>
<%!
   from django.core.urlresolvers import reverse
   from courseware.courses import course_image_url, get_course_about_section
   from courseware.access import has_access
   from certificates.models import CertificateStatuses
   from xmodule.modulestore import MONGO_MODULESTORE_TYPE
   from xmodule.modulestore.django import modulestore
   from prop_dict.models import schools,districts,subject_areas,grade_levels,years_in_educations
   from prop_dict.models import get_district,get_school,get_grade_level,get_subject_area,get_years_in_education
   import json
   %>

<%static:js group='main_vendor'/>
<%static:js group='application'/>

<style type="text/css" media="screen">
  #form-table{border:none;}
  #form-table td{border:none;padding-top:20px;}
  #form-table td.label{text-align:right;}
  table.datalist td{padding:5px;}
  div.nav a{font-size:18px;background:#ddd;padding:5px;}
  div.nav{margin-bottom:10px;text-align:left;}
</style>
<script type="text/javascript" src="/static/js/vendor/jquery.form.js" charset="utf-8"></script>
<div style="text-align:center;">
  <div style="width:960px;margin:auto;">
    <div class="nav">
      <a href="/district">district</a>
      <a href="/contract" style="background:#fa0">contract</a>
      <a href="/school">school</a>
    </div>
    <div style="background:#ddd;padding:20px;text-align:left;">
      %if ui=='list':
      <table class="datalist" width="100%" border="1" style="border-collapse:collapse;">
        <tr>
          <td style="width:0px;"></td>
          <td>id</td>
          <td>name</td>
          <td>district</td>
          <td>number of licences</td>
          <td>status</td>
          <td>date</td>
          <td></td>
        </tr>
        % for  c in contracts:
        <tr>
          <td><input type="checkbox" name="id" value="${c.id}" /></td>
          <td>${c.id}</td>
          <td><a href="${reverse("contract_modify",args=[c.id])}">${c.name}</a> </td>
          <td></td>
          <td>${c.licenses}</td>
          <td></td>
          <td></td>
          <td style="text-align:center;"><a href="">Users</a></td>
        </tr>
        % endfor
      </table>
      <div style="padding:5px;text-align:right;">
        <input type="button" onclick="window.location='${reverse("contract_create")}'" value="Add New Contract" />
        <input type="button" name="" value="Delete Selected" />
      </div>
      %endif
      %if import_from:
      <form id="form_import" method="post" style="float:right;width:660px;text-align:left;">
        <input type="hidden" name="contract_id" id="contract_id" value="" />
        <div style="margin:50px;">
          <h2>Import User</h2>
          <table id="form-table">
            <tr>
              <td class="label">Contract Name</td>
              <td><input type="file" id="file" name="file" value="" /></td>
            </tr>
            <tr>
              <td class="label"></td>
              <td><input type="submit" value="Submit" /></td>
            </tr>
          </table>
        </div>
      </form>
      %endif
      %if contract_from:
      <form id="form_contract" method="post" style="width:660px;text-align:left;">
        <input type="hidden" name="contract_id" id="contract_id" value="" />
        %if contract:
        <h2>Modify Contract 	</h2>
        %else:
        <h2>Add Contract 	</h2>
        %endif
        <div id="message" style="background:#ff6;"></div>
        <table id="form-table">
          <tr>
            <td class="label">Contract Name</td>
            <td><input id="name" name="name" style="width:400px;"/></td>
          </tr>
          <!-- <tr> -->
          <!--   <td class="label">State</td> -->
          <!--   <td> -->
          <!--     <select id="" name="" autocomplate="off"> -->
          <!--       <option value=""></option> -->
          <!--     </select> -->
          <!--   </td> -->
          <!-- </tr> -->
          
          <tr>
            <td class="label">District</td>
            <td>
              <select id="" name="" autocomplate="off">
                <option value=""></option>
              </select>
            </td>
          </tr>
          
          <tr>
            <td class="label">Term</td>
            <td>
              <select id="term_months" name="term_months" autocomplate="off">
                <option value="6">6</option>
                <option value="12">12</option>
              </select>
            </td>
          </tr>
          <tr>
            <td class="label">Number of licenses</td>
            <td>
              <input id="licenses" name="licenses" value="" />
            </td>
          </tr>
          <tr>
            <td class="label"></td>
            <td><input type="submit" value="Submit" /></td>
          </tr>
        </table>
      </form>
      %endif
    </div>  
  </div>
</div>
<script type="text/javascript">
  var submit_count_down=3;
  var contract=null;
  %if contract:
  contract=${json.dumps(contract)}
  $("#contract_id").val(contract.id)
  $("#name").val(contract.name)
  $("#district_id").val(contract.district_id)
  $("#term_months").val(contract.term_months)
  $("#licenses").val(contract.licenses)
  %endif
  $("#form_import").submit(function(){
  $(this).ajaxSubmit(
  {
  type:'post',
  url:'${reverse('contract_import_user_submit')}',
  success:function(json, status){
  alert(json.message)
  $("#message").html("success");
  },
  error:function(json){
  alert("Server error.")
  }
  });
  return false;
  });
  $("#form_contract").submit(function(){
  var contract_id=$(this.contract_id).val()
  var name=$(this.name).val()
  var district_id=$(this.district_id).val()
  var state_id=$(this.state_id).val()
  var term_months=$(this.term_months).val()
  var licenses=$(this.licenses).val()
  $("#message").html("Submiting");
  $.post(
  '${reverse("contract_submit")}',
  {
  "contract_id":contract_id,
  "name" : name,
  "district_id":district_id,
  "state_id":state_id,
  "term_months":term_months,
  "licenses":licenses},
  function(data) {
  if (data.success) {
  $(this).resetForm()
  function count(){
  setTimeout(function(){
  if(submit_count_down<1)
                         window.location.href="${reverse("contract_index")}"
                         $("#message").html("Submit success. Now go back ... " + submit_count_down);
                         submit_count_down--
                         count()
                         },1000);
                         }
                         count();
                         } else {
                         $("#message").html(data.error);
                         }
                         }
                         );
                         return false;
                         });
                         </script>
